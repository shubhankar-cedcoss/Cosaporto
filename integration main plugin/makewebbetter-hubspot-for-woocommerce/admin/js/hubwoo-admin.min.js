!function(e){"use strict";const o=hubwooi18n.ajaxUrl,t=hubwooi18n.hubwooWentWrong,s=hubwooi18n.hubwooMailSuccess,a=hubwooi18n.hubwooMailFailure,r=hubwooi18n.hubwooSecurity,u=hubwooi18n.hubwooAccountSwitch,n=hubwooi18n.hubwooOcsSuccess,c=hubwooi18n.hubwooOcsError,i=(hubwooi18n.hubwooOverviewTab,{percentage:0,totalCount:0,totalGrpPrCreated:0});jQuery(document).ready(function(){const l=(e,o)=>{let t;return function(){const s=this,a=arguments;clearTimeout(t),t=setTimeout(()=>e.apply(s,a),o)}},h=async()=>{let e=await jQuery.ajax({url:o,type:"POST",data:{action:"hubwoo_ecomm_setup",hubwooSecurity:r,process:"upsert-store"}});if(200==(e=jQuery.parseJSON(e)).status_code){const t=e.body.id;jQuery(".hubwoo-info").data("products");await p({hubwoo_ecomm_store_id:t}),await jQuery.ajax({url:o,type:"POST",data:{action:"hubwoo_ecomm_setup",hubwooSecurity:r,process:"start-products-sync"}}),await jQuery.ajax({url:o,type:"POST",data:{action:"hubwoo_ecomm_setup",hubwooSecurity:r,process:"update-deal-stages"}})}return e},d=(e,o,t="none")=>{"add"==o?(e.addClass("fa"),e.removeClass("hubwoo-cr-btn"),e.removeClass("hubwoo-crd-btn"),e.addClass("fa-spinner"),e.addClass("fa-spin"),e.text("")):"remove"==o&&(e.removeClass("fa"),e.removeClass("fa-spinner"),e.removeClass("fa-spin"),e.addClass("hubwoo-cr-btn"),e.text("Created"),"failed"==t&&(e.addClass("hubwoo-crd-btn"),e.text("Create")))},w=(e,o=1)=>{1==o?(jQuery(".hubwoo-progress-bar").css("width",e+"%"),jQuery(".hubwoo-progress-bar").html(e+"%"),jQuery(".hubwoo-progress-notice").html(n)):2==o&&(jQuery(".hubwoo-progress-notice").html(c),jQuery(".hubwoo-progress-bar").addClass("hubwoo-progress-error"),jQuery(".hubwoo-progress-bar").css("width","100%"),jQuery(".hubwoo-progress-bar").html("Failed! Please check error log or contact support"))},_=async(e,o)=>{let t,s=!0,a=window.location.href;switch(null==o&&(o="hubwoo_key"),a.includes(o)||(a=jQuery(".mwb-heb__nav-list-item:eq(0) a").attr("href")),t=a.substring(0,a.indexOf(o)),t+=o,e){case"move-to-grp-pr":t+="=grp-pr-setup";break;case"move-to-list":t+="=list-setup";break;case"move-to-sync":t+="=sync";break;case"greet-to-dashboard":await p({hubwoo_connection_setup_established:1}),t+="=hubwoo-overview";break;case"move-to-dashboard":t+="=hubwoo-overview";break;case"skip-list-creation":jQuery(".hubwoo_pop_up_wrap").slideUp(800),s="hubwoo_key"==o&&"true"==await p({hubwoo_pro_lists_setup_completed:1});break;default:location.reload()}s&&(window.location.href=t)},y=()=>{jQuery.post(o,{action:"hubwoo_get_user_for_current_roles",hubwooSecurity:r},function(e){let o="We have found "+e+" Users";jQuery("#hubwoo_customers_manual_sync").is(":checked")&&(o+=` from ${jQuery("#hubwoo_users_from_date").val()} to ${jQuery("#hubwoo_users_upto_date").val()}`),jQuery(".hubwoo-ocs-btn-notice").text(o+" ready to be synced over HubSpot"),e>0?(jQuery(".hubwoo-osc-instant-sync").attr("data-total_users",e),jQuery("#hubwoo-osc-instant-sync").show()):(jQuery(".hubwoo-ocs-btn-notice").delay(1500).slideDown(5e3),jQuery(".hubwoo-ocs-btn-notice").text("We can't found new Users, please try changing filters."),jQuery("#hubwoo-osc-instant-sync").hide(),jQuery("#hubwoo-osc-schedule-sync").hide()),e>500&&(jQuery("#hubwoo-osc-schedule-sync").show(),jQuery("#hubwoo-osc-instant-sync").hide());const t=jQuery("#hubwoo_customers_role_settings").val();void 0!==t&&0!==t.length||(jQuery(".hubwoo-ocs-btn-notice").hide(),jQuery("#hubwoo-osc-instant-sync").hide(),jQuery("#hubwoo-osc-schedule-sync").hide())})},b=async(e,t)=>{const s=await jQuery.ajax({type:"POST",url:o,data:{action:"hubwoo_ocs_instant_sync",step:e,hubwooSecurity:r},dataType:"json"}).fail(e=>{w(e.progress,2),p(["hubwoo_total_ocs_need_sync"],"delete")});100==s.progress&&1!=s.propertyError?(w(s.progress),jQuery(".hubwoo-progress-notice").html(n),jQuery("a#hubwoo-osc-instant-sync").hide(),await p({hubwoo_greeting_displayed_setup:"yes"}),location.reload()):1==s.propertyError?(w(100,2),p(["hubwoo_total_ocs_need_sync"],"delete")):(w(Math.ceil(s.progress)),b(parseInt(s.step),parseInt(s.progress)))},p=(e,t="update")=>jQuery.post(o,{action:"hubwoo_save_updates",hubwooSecurity:r,updates:e,type:t}),m=(e,o=null,t=!1)=>{const s={};return e.map(e=>{let{name:a,value:r}=e;null!=o&&o.map(e=>{a==e.key&&(e.status="yes")}),0==a.includes("[]")&&t&&(s[a]=r),a.includes("[]")&&(a=a.replace("[]",""),s.hasOwnProperty(a)?s[a].push(r):s[a]=[r])}),null!==o&&o.map(e=>{s[e.key]=e.status}),s};Object.entries({hubwoo_customers_manual_sync:".hubwoo-date-range",hubwoo_abncart_delete_old_data:".delete-after-date",hubwoo_checkout_optin_enable:"#hubwoo_checkout_optin_label",hubwoo_registeration_optin_enable:"#hubwoo_registeration_optin_label"}).map(e=>{const[o,t]=e;jQuery(`#${o}`).is(":checked")?jQuery(t).closest("tr").slideDown():jQuery(t).closest("tr").hide()}),jQuery("#hubwoo_pro_switch").on("click",function(e){if(!confirm(u))return e.preventDefault(),!1}),"false"==jQuery("#get_workflow_scope").val()&&setTimeout(function(){jQuery(".hubwoo_pop_up_wrap").slideDown("slow")},1e3),null!=jQuery("#hubwoo_customers_role_settings").val()&&jQuery.post(o,{action:"hubwoo_get_current_sync_status",hubwooSecurity:r,data:{type:"contact"}},function(e){!0===(e=jQuery.parseJSON(e))||1==e?(jQuery("#hubwoo_customers_role_settings").attr({disabled:"true"}),jQuery("#hubwoo_customers_manual_sync").attr({disabled:"true"})):y()});const j=jQuery(".hubwoo-form-wizard-wrapper").find(".hubwoo-form-wizard-link").innerWidth(),Q=jQuery(".hubwoo-form-wizard-wrapper").find(".hubwoo-form-wizard-link").position();null!=Q&&jQuery(".hubwoo-form-wizardmove-button").css({left:Q.left,width:j}),jQuery(".hubwoo-form-wizard-wrapper").find(".hubwoo-form-wizard-link").click(function(){jQuery(".hubwoo-form-wizard-link").removeClass("active");const e=jQuery(this).innerWidth();jQuery(this).addClass("active");const o=jQuery(this).position();jQuery(".hubwoo-form-wizardmove-button").css({left:o.left,width:e});const t=jQuery(this).attr("data-attr");jQuery(".hubwoo-form-wizard-content").each(function(){jQuery(this).attr("data-tab-content")==t?jQuery(this).addClass("show"):jQuery(this).removeClass("show")})}),jQuery(".hubwoo-form-wizard-next-btn").click(function(){const e=jQuery(this);e.parents(".hubwoo-form-wizard-content").toggle("slow"),e.parents(".hubwoo-form-wizard-content").next(".hubwoo-form-wizard-content").toggle("slow"),jQuery(document).find(".hubwoo-form-wizard-content").each(function(){if(jQuery(this).hasClass("show")){const e=jQuery(this).attr("data-tab-content");jQuery(document).find(".hubwoo-form-wizard-wrapper li a").each(function(){if(jQuery(this).attr("data-attr")==e){jQuery(this).addClass("active");const e=jQuery(this).innerWidth(),o=jQuery(this).position();jQuery(document).find(".hubwoo-form-wizardmove-button").css({left:o.left,width:e})}else jQuery(this).removeClass("active")})}})}),jQuery(".hubwoo-form-wizard-previous-btn").click(function(){const e=jQuery(this);e.parents(".hubwoo-form-wizard-content").removeClass("show"),e.parents(".hubwoo-form-wizard-content").prev(".hubwoo-form-wizard-content").addClass("show"),jQuery(document).find(".hubwoo-form-wizard-content").each(function(){if(jQuery(this).hasClass("show")){const e=jQuery(this).attr("data-tab-content");jQuery(document).find(".hubwoo-form-wizard-wrapper li a").each(function(){if(jQuery(this).attr("data-attr")==e){jQuery(this).addClass("active");const e=jQuery(this).innerWidth(),o=jQuery(this).position();jQuery(document).find(".hubwoo-form-wizardmove-button").css({left:o.left,width:e})}else jQuery(this).removeClass("active")})}})}),jQuery(".mwb-woo__accordian-heading").click(function(){const o=e(this).data("name");jQuery(".grToCreate").removeClass("fa-minus").addClass("fa-plus"),jQuery(".mwb-woo__accordian-heading").is(".gr_created")&&jQuery(".gr_created").parent("div").children("i").removeClass("fa fa-chevron-down").addClass("fa fa-chevron-right"),jQuery(this).hasClass("active")?jQuery(this).hasClass("active")&&(jQuery(this).hasClass("gr_created")&&jQuery("#fa-"+o).removeClass("fa fa-chevron-down").addClass("fa fa-chevron-right"),jQuery(this).hasClass("gr_uncreated")||(jQuery(this).removeClass("active"),jQuery(this).parents(".mwb-woo__accordion-wrapper").children(".mwb-woo__accordion-content").slideUp(500))):(jQuery("#fa-drag-"+o).removeClass("fa-plus").addClass("fa-minus"),jQuery(this).hasClass("gr_created")&&(jQuery(this).parent("div").children("i").removeClass("fa fa-chevron-right").addClass("fa fa-chevron-down"),jQuery("#fa-"+o).removeClass("fa fa-chevron-right").addClass("fa fa-chevron-down")),jQuery(this).hasClass("gr_uncreated")||(jQuery(".mwb-woo__accordian-heading").removeClass("active"),jQuery(".mwb-woo__accordion-content").slideUp(500),jQuery(this).addClass("active"),jQuery(this).parents(".mwb-woo__accordion-wrapper").children(".mwb-woo__accordion-content").slideDown(500)))}),jQuery(".mwb-woo__accordian-heading").hover(function(){jQuery(this).parent("div").children("span").hasClass("grCreateNew")&&jQuery(this).prop("title","Create group first, before creating properties.")}),jQuery("input.hub-group").on("click",function(){const e=jQuery(this).data("group"),o=jQuery(this).data("req"),t=jQuery(this).prop("checked");if("yes"==o)return!1;jQuery("div#"+e).find("input[type=checkbox]").each(function(){jQuery(this).attr("checked",t),t?jQuery(this).removeAttr("disabled"):jQuery(this).attr("disabled",!0)})}),jQuery("#hubwoo-re-auth").click(e=>{e.preventDefault(),p(["hubwoo_pro_oauth_success","hubwoo_pro_account_scopes","hubwoo_pro_valid_client_ids_stored"],"delete"),window.location.href=jQuery("#hubwoo-re-auth").attr("href")}),jQuery("input.hub-prop").on("click",function(){if("yes"==jQuery(this).data("req"))return!1}),jQuery("#hub-lists-form").submit(async e=>{e.preventDefault(),jQuery(".hubwoo-list__manage").slideUp(),jQuery(".hubwoo-btn-list").hide(),jQuery(".hubwoo-list__progress").css("display","block"),w(0);jQuery("input[name='selectedLists[]']").length;const s=jQuery("form#hub-lists-form").serializeArray(),a=[];jQuery.each(s,function(e,o){"selectedLists[]"==o.name&&a.push(o.value)});let u=await jQuery.post(o,{action:"hubwoo_check_oauth_access_token",hubwooSecurity:r});if(!(u=jQuery.parseJSON(u)).status)return alert(t),!1;{let e=await jQuery.post(o,{action:"hubwoo_get_lists",hubwooSecurity:r});e=jQuery.parseJSON(e);const t=[];jQuery.each(e,function(e,o){a.includes(o.name)&&t.push(o)}),i.totalCount=t.length;try{const e=[];let s=!1;await Promise.all(t.map(async t=>{try{const a=await(e=>new Promise((t,s)=>{const a={action:"hubwoo_create_list",listDetails:e,hubwooSecurity:r};jQuery.ajax({url:o,type:"POST",data:a}).then(e=>{if(null!=e){const o=jQuery.parseJSON(e),a=o.status_code;200==a||409==a?(i.totalGrpPrCreated+=1,i.percentage=(i.totalGrpPrCreated/i.totalCount*100).toFixed(0),w(i.percentage),t(o)):s(o)}})}))(t);return 200!=a.status_code&&409!=a.status_code||e.push(t.name),a}catch(e){402==e.status_code?s=!0:console.error(e)}}));s?jQuery(".hubwoo_pop_up_wrap").slideDown("slow"):(await p({"hubwoo-lists-created":e,hubwoo_pro_lists_setup_completed:1}),_("move-to-sync"))}catch(e){console.error(e)}}}),jQuery("span.hubwoo-create-single-group").on("click",function(){const t=e(this).data("name"),s=e(this);d(s,"add"),jQuery.post(o,{action:"hubwoo_check_oauth_access_token",hubwooSecurity:r},function(e){if(!jQuery.parseJSON(e).status)return d(s,"remove","failed"),!1;jQuery.post(o,{action:"hubwoo_create_single_group",name:t,hubwooSecurity:r},function(e){const o=jQuery.parseJSON(e);if(!o.errors){const e=o.status_code;200==e?(d(s,"remove"),s.addClass("grSuccess"),jQuery("#"+t).removeClass("mwb-woo__accordion-content-disable").addClass("mwb-woo__accordion-content"),jQuery(".mwb-woo__accordian-heading").hasClass(t)&&jQuery("."+t).removeClass("gr_uncreated").addClass("gr_created")):409==e?(d(s,"remove"),s.addClass("grSuccess"),jQuery("#"+t).removeClass("mwb-woo__accordion-content-disable").addClass("mwb-woo__accordion-content"),jQuery(".mwb-woo__accordian-heading").hasClass(t)&&jQuery("."+t).removeClass("gr_uncreated").addClass("gr_created")):d(s,"remove","failed")}})})}),jQuery("span.hubwoo-create-single-field").on("click",function(){const t=e(this).data("name"),s=e(this).data("group"),a=e(".pr-"+t);a.removeClass("fa-plus"),a.addClass("fa-spinner"),a.addClass("fa-spin"),jQuery.post(o,{action:"hubwoo_check_oauth_access_token",hubwooSecurity:r},function(e){if(!jQuery.parseJSON(e).status)return a.removeClass("fa-spinner"),a.removeClass("fa-spin"),a.addClass("fa-plus"),!1;jQuery.post(o,{action:"hubwoo_create_single_property",name:t,group:s,hubwooSecurity:r},function(e){const o=jQuery.parseJSON(e);if(!o.errors){const e=o.status_code;200==e?(a.removeClass("fa-spinner"),a.removeClass("fa-spin"),a.addClass("fa-check")):409==e?(a.removeClass("fa-spinner"),a.removeClass("fa-spin"),a.addClass("fa-check")):(a.removeClass("fa-spinner"),a.removeClass("fa-spin"),a.addClass("fa-plus"))}})})}),jQuery(".hubwoo-create-single-list").on("click",function(){const t=e(this).data("name"),s=e(this);d(s,"add"),jQuery.post(o,{action:"hubwoo_check_oauth_access_token",hubwooSecurity:r},function(e){if(!jQuery.parseJSON(e).status)return d(s,"remove","failed"),!1;jQuery.post(o,{action:"hubwoo_create_single_list",name:t,hubwooSecurity:r},function(e){const o=jQuery.parseJSON(e);if(!o.errors){const e=o.status_code;200==e?d(s,"remove"):409==e?d(s,"remove"):402==e?(jQuery(".hubwoo_pop_up_wrap").slideDown("slow"),d(s,"remove","failed")):d(s,"remove","failed")}})})}),jQuery("#save-deal-stages").click(async e=>{e.preventDefault(),jQuery("#hubwoo-ecomm-deal-stage").length&&await p({hubwoo_ecomm_mapping_setup:"yes"}),window.location.reload(!0)}),setInterval(function(){jQuery(".hubwoo-progress-bar").map(async function(e){const t=jQuery(this);if("yes"==t.data("sync-status")){const e=t.data("sync-type");let s=await jQuery.ajax({url:o,type:"POST",data:{action:"hubwoo_sync_status_tracker",hubwooSecurity:r,process:e}});if(s=jQuery.parseJSON(s),t.css("width",s.percentage+"%"),t.text(s.percentage+"%"),s.hasOwnProperty("eta")){const o=jQuery(".sync-desc[data-sync-type='"+e+"']");let t=o.text().trim();const a=o.attr("data-sync-eta");t=t.replace(a,s.eta),o.attr("data-sync-eta",s.eta),o.text(t)}"no"!=s.is_running&&100!=t.data("percentage")&&100!=s.percentage||(t.css("width","100%"),t.text("100%"),window.location.href=window.location.href)}})},25e3),jQuery("#reset-deal-stages").click(async e=>{e.preventDefault(),await jQuery.ajax({url:o,type:"POST",data:{action:"hubwoo_ecomm_setup",hubwooSecurity:r,process:"reset-mapping"}}),window.location.reload(!0)}),jQuery(".hubwoo-create-single-workflow-data").on("click",function(){const s=jQuery(this);var a=jQuery(this).data("name");const u=jQuery(this).closest(".hubwoo-field-text-col");u.removeClass("hubwoo-align-class").addClass("align-big");a=e(this).data("name");const n=e(this);d(n,"add"),jQuery.post(o,{action:"hubwoo_check_oauth_access_token",hubwooSecurity:r},function(c){if(!jQuery.parseJSON(c).status)return u.removeClass("align-big").addClass("hubwoo-align-class"),d(n,"remove","failed"),!1;jQuery.post(o,{action:"hubwoo_create_single_workflow",name:a,hubwooSecurity:r},function(a){const r=jQuery.parseJSON(a);if(!r.errors){const a=r.status_code;if(200==a)d(n,"remove"),u.removeClass("align-big").addClass("hubwoo-align-class"),jQuery.post(o,{action:"hubwoo_update_workflow_tab"},function(o){o=JSON.parse(o);e.each(o,function(o,t){e('.workflow-tab[data-name="'+t+'"]').removeClass("hubwoo-disabled")})}),s.parents(".hubwoo-field-text-col").children("div.hubwoo-field-checked").show();else if(404==a){let e=JSON.parse(r.response);e=e.message,d(n,"remove","failed"),u.removeClass("align-big").addClass("hubwoo-align-class"),alert(e)}else alert(t),d(n,"remove","failed"),u.removeClass("align-big").addClass("hubwoo-align-class")}})})}),jQuery("#hubwoo-order-statuses").select2({placeholder:"Processing, Completed etc.",ajax:{url:ajaxurl,dataType:"json",delay:200,data:e=>({q:e.term,action:"hubwoo_search_for_order_status"}),processResults(o){const t=[];return o&&e.each(o,function(e,o){t.push({id:o[0],text:o[1]})}),{results:t}},cache:!0}}),jQuery("#hubwoo-selected-user-roles, #hubwoo_customers_role_settings").select2({placeholder:"All Users Roles are Selected except Guest.",ajax:{url:ajaxurl,dataType:"json",delay:200,data:e=>({q:e.term,action:"hubwoo_get_for_user_roles"}),processResults(o){const t=[];return o&&e.each(o,function(e,o){t.push({id:o[0],text:o[1]})}),{results:t}},cache:!0}}),jQuery('input[type="checkbox"]').on("change",function(){const e=jQuery(this).attr("id"),o={hubwoo_customers_manual_sync:".hubwoo-date-range",hubwoo_abncart_delete_old_data:".delete-after-date",hubwoo_checkout_optin_enable:"#hubwoo_checkout_optin_label",hubwoo_registeration_optin_enable:"#hubwoo_registeration_optin_label"};if(o.hasOwnProperty(e)){const t=o[e];jQuery(this).is(":checked")?jQuery(t).closest("tr").slideDown("slow"):jQuery(t).closest("tr").hide()}}),jQuery(".date-picker").datepicker({dateFormat:"dd-mm-yy",maxDate:0,changeMonth:!0,changeYear:!0}),jQuery(document).on("click","#hubwoo-osc-instant-sync",async function(e){e.preventDefault(),jQuery("#hubwoo-osc-instant-sync").hide();jQuery("#hubwoo-ocs-form").slideUp(600),jQuery("#hubwoo-osc-instant-sync").addClass("hubwoo-disable"),jQuery("#hubwoo-osc-schedule-sync").addClass("hubwoo-disable"),jQuery(".hubwoo-progress-wrap").css("display","block");const o=jQuery(".hubwoo-osc-instant-sync").data("total_users");await p({hubwoo_total_ocs_need_sync:o}),w(0),b(1,0)}),jQuery(".hubwoo-date-picker").datepicker({dateFormat:"dd-mm-yy",maxDate:0,changeMonth:!0,changeYear:!0}),jQuery("#hubwoo-pro-email-logs").on("click",function(e){e.preventDefault(),jQuery("#hubwoo_email_loader").css({display:"inline-block"}),jQuery.post(o,{action:"hubwoo_email_the_error_log",hubwooSecurity:r},function(e){const o=jQuery.parseJSON(e);null!=o&&"success"==o?(alert(s),jQuery("#hubwoo_email_loader").css({display:"none"}),jQuery("#hubwoo_email_success").css({display:"inline-block"})):(alert(a),jQuery("#hubwoo_email_loader").css({display:"none"})),jQuery("#hubwoo_email_success").css({display:"none"})})}),jQuery(".hubwoo-general-settings-fields").on("change",function(){const e=jQuery("#plugin-settings-gen-adv").serializeArray(),o=m(e,[{key:"hubwoo_checkout_optin_enable",status:"no"},{key:"hubwoo_registeration_optin_enable",status:"no"}],!0);[{key:"hubwoo-order-statuses",status:"EMPTY_ARRAY"},{key:"hubwoo-selected-user-roles",status:"EMPTY_ARRAY"}].map(e=>{0==o.hasOwnProperty(e.key)&&(o[e.key]=e.status)}),p(o)}),jQuery(".hubwoo_rfm_data_fields").on("change",l(function(){const e=jQuery("#hubwoo-rfm-form").serializeArray(),o=m(e);p(o)},800)),jQuery("#hubwoo_ecomm_order_ocs_enable").is(":checked")&&jQuery.post(o,{action:"hubwoo_get_current_sync_status",hubwooSecurity:r,data:{type:"deal"}},function(e){if(1!=(e=jQuery.parseJSON(e))||1!=e)(async()=>{const e=await jQuery.post(o,{action:"hubwoo_ecomm_get_ocs_count",hubwooSecurity:r});let t="No Users found. Please change the filters below.";e>0?(t=`You have ${e} Orders for the selected time frame and order status.`,jQuery(".manage_deals_ocs").show()):(jQuery(".manage_deals_ocs").hide(),jQuery(".deal-sync_progress").hide(),t="No Orders found for the selected time frame and order status."),jQuery(".hubwoo_deals_message").text(t),jQuery(".hubwoo-group-wrap__deal_notice").slideDown("slow")})();else{jQuery("#hubwoo_deals_ocs_form").serializeArray().map(({name:e})=>{jQuery(`#${e}`).attr({disabled:"true"})})}}),jQuery(".hubwoo_real_time_changes").on("change",l(()=>{const e=jQuery("#hubwoo_real_time_deal_settings").serializeArray(),o=m(e,[{key:"hubwoo_ecomm_deal_enable",status:"no"}],!0);[{key:"hubwoo_ecomm_won_stages",status:"EMPTY_ARRAY"}].map(e=>{0==o.hasOwnProperty(e.key)&&(o[e.key]=e.status)}),p(o)},800)),jQuery(".hubwoo_ecomm_mapping").on("change",l(()=>{const e=jQuery(".hubwoo_save_ecomm_mapping").serializeArray(),o=[];for(let t=0;t<e.length;t++){const s={};s.status=e[t].value,s.deal_stage=e[++t].value,o.push(s)}p({hubwoo_ecomm_final_mapping:o})},300)),jQuery("#hubwoo_ecomm_won_stages").select2({placeholder:"Select Winning Deal Stages.",ajax:{url:ajaxurl,dataType:"json",delay:200,data:e=>({q:e.term,action:"hubwoo_deals_search_for_stages"}),processResults(o){const t=[];return o&&e.each(o,function(e,o){t.push({id:o[0],text:o[1]})}),{results:t}},cache:!0}}),jQuery(".hubwoo-ecomm-settings-select").on("change",async()=>{const e=jQuery("#hubwoo_deals_ocs_form").serializeArray(),t=m(e,[{key:"hubwoo_ecomm_order_ocs_enable",status:"no"}],!0),s=await jQuery.post(o,{action:"hubwoo_get_current_sync_status",hubwooSecurity:r,data:{type:"deal"}});if(1!=s||1!=s){if(await p(t))if("yes"==t.hubwoo_ecomm_order_ocs_enable){const e=await jQuery.get(o,{action:"hubwoo_ecomm_get_ocs_count",hubwooSecurity:r});if(void 0!==e||null!==e){jQuery(".hubwoo_deals_message").slideDown(20),jQuery(".hubwoo_deals_message").css("display","inline-block"),jQuery(".hubwoo-group-wrap__deal_notice").slideDown(200);let o="No Users found. Please change the filters below.";e>0?(o=`You have ${e} Orders for the selected time frame and order status.`,jQuery(".manage_deals_ocs").show()):(jQuery(".manage_deals_ocs").hide(),o="No Orders found for the selected time frame and order status."),jQuery(".hubwoo_deals_message").text(o)}}else jQuery(".hubwoo_deals_message").hide(),jQuery(".manage_deals_ocs").hide(),jQuery(".hubwoo-group-wrap__deal_notice").slideUp(150)}else jQuery(".hubwoo-deals-settings-select").attr({disabled:"true"})}),jQuery(".manage_deals_ocs, .manage_contact_sync, .manage_product_sync").click(async function(){const e=jQuery(this).data("action");void 0!==e&&("run-ecomm-setup"===e?await h():await jQuery.post(o,{action:"hubwoo_manage_sync",hubwooSecurity:r,process:e}),window.location.reload(!0))}),jQuery(".hubwoo-abncart-setup-form").on("change",l(function(){const e=jQuery(".hubwoo-abncart-setup-form").serializeArray(),o=m(e,[{key:"hubwoo_abncart_enable_addon",status:"no"},{key:"hubwoo_abncart_guest_cart",status:"no"},{key:"hubwoo_abncart_delete_old_data",status:"no"}],!0);p(o)},700)),jQuery(".hubwoo-btn-cshow__btn a").click(function(o){o.preventDefault(),e(this).parents(".hubwoo-box-card").find(".hubwoo-btn-cshow__content").toggle("slow")}),jQuery(".hubwoo-btn-data").click(function(e){e.preventDefault(),jQuery(this).parents(".hubwoo-btn-list").next(".hubwoo-sub-content").children("div").hide();const o=jQuery(this).data("action");"group_setup"==o?(jQuery(this).parents(".hubwoo-btn-list").next(".hubwoo-sub-content").children(".hubwoo-group__progress").show(),jQuery("#hubwoo_create_group_prop_setup").hide(),jQuery(".gen-text").hide(),jQuery("#hub-gr-props-form").submit()):"group_manage_setup"==o&&(jQuery(".grp-pr-heading").text("Created Properties & Groups"),jQuery(".hubwoo-content__para").hide(),jQuery(this).parents(".hubwoo-btn-list").next(".hubwoo-sub-content").children(".hubwoo-group__manage").slideDown("slow"),jQuery(".hubwoo-group-desc").show(),jQuery("#hubwoo_create_group_prop_setup").hide(),jQuery("#hubwoo-manage-setup").hide()),"lists_setup"==o?(jQuery(this).parents(".hubwoo-btn-list").next(".hubwoo-sub-content").children(".hubwoo-list__progress").show(),jQuery("#hub-lists-form").submit()):"lists_setup_manage"==o&&(jQuery(this).parents(".hubwoo-btn-list").next(".hubwoo-sub-content").children(".hubwoo-list__manage").slideDown("slow"),jQuery(".list-setup-heading").text("Lists"),jQuery(".hubwoo-content__para").hide(),jQuery(".hubwoo-list-desc").show(),jQuery(".hubwoo-btn-data").hide(),jQuery("#hub-lists-form").slideDown())}),jQuery(".hubwoo_manage_screen").click(()=>{const e=jQuery(".hubwoo_manage_screen").data("process"),o=jQuery(".hubwoo_manage_screen").data("tab");_(e,o)}),jQuery(".hubwoo-adv-settingg__btn a").click(function(){jQuery(this).parents(".hubwoo-adv-settingg").children(".hubwoo-adv-settingg__form").toggle("slow")}),jQuery(".hubwoo-deal-wrap-con__h-btn a").click(function(e){e.preventDefault(),jQuery(this).parents(".hubwoo-deal-wrap-con").children(".hubwoo-deal-wrap-con__store").toggle("slow")}),jQuery("#hubwoo_disconnect_account, #hubwoo-change-account").click(function(){jQuery.post(o,{action:"hubwoo_disconnect_account",hubwooSecurity:r},function(e){e&&location.reload()})}),jQuery(".hubwoo-ocs-input-change").on("change",async()=>{const e=jQuery("#hubwoo-ocs-form").serializeArray(),t=m(e,[{key:"hubwoo_customers_manual_sync",status:"no"}],!0);[{key:"hubwoo_customers_role_settings",status:"EMPTY_ARRAY"}].map(e=>{0==t.hasOwnProperty(e.key)&&(t[e.key]=e.status)}),p(t),jQuery.post(o,{action:"hubwoo_get_current_sync_status",hubwooSecurity:r},function(e){1!=(e=jQuery.parseJSON(e))||1!=e?y():(jQuery("#hubwoo_customers_role_settings").attr({disabled:"true"}),jQuery("#hubwoo_customers_manual_sync").attr({disabled:"true"}))})}),jQuery("#hub-gr-props-form").submit(async e=>{e.preventDefault();const t=jQuery("form#hub-gr-props-form").serializeArray(),s=[],a=[];jQuery(".hubwoo-group__progress").css("display","block"),w(0),jQuery.each(t,function(e,o){"selectedGroups[]"==o.name?s.push(o.value):"selectedProps[]"==o.name&&a.push(o.value)}),i.totalCount=s.length+a.length;const u=10*i.totalCount/100;i.totalCount+=u;let n=await jQuery.post(o,{action:"hubwoo_check_oauth_access_token",hubwooSecurity:r});if((n=jQuery.parseJSON(n)).status){const e=[],t=[];try{await Promise.all(s.map(async s=>{try{const a=await((e,t)=>{let s="";"contact"==t?s="hubwoo_create_property_group":"deal"==t&&(s="hubwoo_deals_create_group");const a={action:s,createNow:"group",groupName:e,hubwooSecurity:r};return new Promise((t,s)=>{jQuery.ajax({url:o,type:"POST",data:a}).done(o=>{const a=jQuery.parseJSON(o);a.name=e,200==a.status_code||409==a.status_code?(i.totalGrpPrCreated+=1,i.percentage=(i.totalGrpPrCreated/i.totalCount*100).toFixed(0),w(i.percentage),t(a)):s(a)})})})(s,"contact");let u=null;if(200==a.status_code?u=a.name:409==a.status_code&&(u=a.name),null!==u){let s=[];e.push(u);let a=await jQuery.ajax({url:o,type:"POST",data:{action:"hubwoo_get_group_properties",groupName:u,hubwooSecurity:r}});(null!=a||a.length>0)&&(s=((e,o)=>{const t=[],s=e.length;let a=0,r=Math.round(s/o),u=o;for(let s=0;s<r+1;s+=1){const s=e.slice(a,u);s.length>0&&t.push(s),a=u,u+=o}return t})(a=(a=jQuery.parseJSON(a)).map(e=>({...e,groupName:u})),16),await Promise.all(s.map(async e=>{try{const s=await((e,t)=>{let s="";return"contact"==t?s="hubwoo_create_group_property":"deal"==t&&(s="hubwoo_deals_create_property"),new Promise((t,a)=>{const u={action:s,propertyDetails:e,hubwooSecurity:r};jQuery.ajax({url:o,type:"POST",data:u}).done(function(e){const o=jQuery.parseJSON(e);201==o.status_code?(i.totalGrpPrCreated+=o.body.results.length,i.percentage=(i.totalGrpPrCreated/i.totalCount*100).toFixed(0),w(i.percentage),t(o)):207==o.status_code?(i.totalGrpPrCreated+=o.body.numErrors,i.percentage=(i.totalGrpPrCreated/i.totalCount*100).toFixed(0),w(i.percentage),t(o)):a(o)})})})(e,"contact");let a=[];return 201==s.status_code?(a=s.body.results).map(e=>{t.push(e.name)}):207==s.status_code&&(a=s.body.errors).map(e=>{const o=e.message,s=o.slice(o.indexOf("named")+5,o.indexOf("already")-1);t.push(s)}),s}catch(e){console.error(e)}})))}}catch(e){console.error(e)}}));await p({"hubwoo-groups-created":e,"hubwoo-properties-created":t,hubwoo_fields_setup_completed:1,hubwoo_pro_setup_completed:1}),await h()}catch(e){console.error(e)}w(100),_("move-to-list")}})})}(jQuery);